<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿˜å¹´ä¼š å¸­æ±ºã‚ï¼†æŠ½é¸åˆ¸</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }

        .container {
            background: #f0f4f8;
            padding: 2rem;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            text-align: center;
            width: 90%;
            max-width: 700px;
            position: relative;
        }

        h1 { font-size: 2rem; margin-bottom: 1.5rem; color: #2c3e50; }

        .input-group {
            display: flex; justify-content: center; align-items: center;
            gap: 15px; margin-bottom: 30px; font-size: 1.5rem;
        }
        input[type="number"] {
            padding: 15px; font-size: 1.5rem; width: 100px; text-align: center;
            border: 3px solid #ddd; border-radius: 12px;
        }

        /* --- ãƒã‚±ãƒƒãƒˆã‚¨ãƒªã‚¢ --- */
        .ticket-view {
            background: #fffaf0;
            border: 6px solid #d4af37;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            background-image: radial-gradient(#d4af37 15%, transparent 16%), radial-gradient(#d4af37 15%, transparent 16%);
            background-size: 12px 12px;
            background-position: 0 0, 6px 6px;
            min-height: 300px;
            display: flex; justify-content: center; align-items: center;
        }
        
        .ticket-inner {
            background: white;
            border: 3px dashed #d4af37;
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .ticket-title {
            font-size: 1.5rem; color: #d4af37; font-weight: bold; letter-spacing: 3px; margin-bottom: 10px;
        }

        .result-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .number-display {
            font-size: 9rem; font-weight: 900; color: #333; line-height: 1;
            margin: 10px 0; text-shadow: 3px 3px 0px #eee;
        }

        /* é¢ç™½ç”»åƒ */
        .surprise-img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            border: 5px solid #e74c3c;
            transform: rotate(-10deg);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
            display: none;
        }
        .surprise-img.show {
            display: block;
            animation: popImage 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ã³ã£ãã‚Šç®±ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .gift-box {
            font-size: 8rem;
            display: none;
        }
        .gift-box.shaking {
            display: block;
            animation: shake 0.5s infinite;
        }

        .ticket-sub {
            font-size: 1.2rem; color: #7f8c8d; margin-top: 10px;
        }

        .photo-msg {
            color: #e74c3c; font-weight: bold; font-size: 1.5rem;
            margin-top: 25px; animation: flash 1.5s infinite;
        }

        .status-text {
            color: #7f8c8d; margin-bottom: 20px; font-size: 1.2rem; font-weight: bold;
        }

        button { cursor: pointer; border: none; border-radius: 60px; font-weight: bold; transition: 0.1s; }
        button:active { transform: scale(0.98); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-primary {
            background-color: #3498db; color: white;
            font-size: 2rem; padding: 20px 40px; width: 80%;
            margin-bottom: 20px; box-shadow: 0 6px 10px rgba(52, 152, 219, 0.3);
        }

        .btn-start {
            background-color: #2ecc71; color: white;
            padding: 15px 40px; font-size: 1.5rem; margin-top: 20px;
        }

        .control-panel { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        .btn-mini { padding: 12px 25px; font-size: 1rem; color: white; }
        .bg-gray { background-color: #95a5a6; }
        .bg-purple { background-color: #9b59b6; }
        .bg-red { background-color: #e74c3c; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 20px; border-radius: 15px;
            width: 95%; max-width: 800px; max-height: 90vh; overflow-y: auto; text-align: center;
        }
        .grid-container {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(55px, 1fr)); gap: 8px; margin: 15px 0;
        }
        .grid-item {
            border: 1px solid #ddd; border-radius: 8px; padding: 10px 0; font-weight: bold; font-size: 1.1rem;
            position: relative; background-color: #fff; color: #333;
        }
        .grid-item.drawn { background-color: #bdc3c7; color: #fff; border-color: #bdc3c7; }
        .grid-item.drawn::after {
            content: "æ¸ˆ"; position: absolute; top: -5px; right: -5px; background: #e74c3c; color: white;
            font-size: 0.7rem; padding: 2px 5px; border-radius: 4px;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        @keyframes pop { 0% { transform: scale(0); opacity: 0; } 80% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes popImage { 0% { transform: scale(0) rotate(0deg); } 100% { transform: scale(1) rotate(-10deg); } }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        
        .pop-in { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <div id="setup-screen">
            <h1>ğŸ‰ å¿˜å¹´ä¼š å—ä»˜è¨­å®š</h1>
            <p style="font-size: 1.2rem;">æ‹…å½“ã™ã‚‹ç•ªå·ã®ç¯„å›²</p>
            <div class="input-group">
                <input type="number" id="min-num" value="1" min="1">
                <span>ï½</span>
                <input type="number" id="max-num" value="50" min="1">
            </div>
            <button class="btn-start" onclick="initApp()">å—ä»˜ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>

        <div id="main-screen" class="hidden">
            <h1 style="font-size: 2rem;">å¸­æ±ºã‚ ï¼† æŠ½é¸åˆ¸</h1>
            
            <div class="ticket-view">
                <div class="ticket-inner">
                    <div class="ticket-title">SPECIAL TICKET</div>
                    
                    <div id="gift-box" class="gift-box">ğŸ</div>

                    <div id="result-area" class="result-container">
                        <div id="display" class="number-display">?</div>
                        <img id="special-img" class="surprise-img" src="" alt="Lucky!">
                    </div>

                    <div class="ticket-sub">No. <span id="ticket-range"></span></div>
                    <div id="photo-instruction" class="photo-msg hidden">
                        ğŸ“¸ ã“ã®ç”»é¢ã‚’ã‚¹ãƒãƒ›ã§æ’®å½±ã—ã¦ãã ã•ã„ï¼<br>
                        ï¼ˆæŠ½é¸ä¼šã§å¿…è¦ã«ãªã‚Šã¾ã™ï¼‰
                    </div>
                </div>
            </div>

            <button id="draw-btn" class="btn-primary" onclick="startDrawSequence()">ãã˜ã‚’å¼•ã</button>
            <div id="count-info" class="status-text">æ®‹ã‚Š: - æš</div>

            <div class="control-panel">
                <button class="btn-mini bg-purple" onclick="openStatusModal()">ğŸ“Š ç¢ºèª</button>
                <button id="undo-btn" class="btn-mini bg-gray" onclick="undo()" disabled>â†© æˆ»ã™</button>
                <button class="btn-mini bg-red" onclick="resetApp()">âš™ çµ‚äº†</button>
            </div>
        </div>
    </div>

    <div id="status-modal" class="modal hidden" onclick="closeStatusModal(event)">
        <div class="modal-content">
            <h3 class="modal-title">å‡ºç¾æ¸ˆã¿ãƒªã‚¹ãƒˆ</h3>
            <div id="status-grid" class="grid-container"></div>
            <button class="btn-mini bg-gray" style="font-size: 1rem; padding: 10px 30px;" onclick="document.getElementById('status-modal').classList.add('hidden')">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ==========================================
        //  ğŸ‘‡ ã“ã“ã«é¢ç™½ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ›¸ã„ã¦ãã ã•ã„
        // ==========================================
        const funnyImages = [
            "photo01.jpg", 
            "photo02.JPG",
            "photo03.JPG",
            "photo04.JPG",
            "photo05.JPG",
            "photo06.JPG",
            "photo07.JPG",
            "photo08.JPG",
            "photo09.JPG",
            "photo10.JPG",
            "photo11.JPG",
            "photo12.JPG",
            "photo13.JPG",
            // ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã ã‘ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¿½åŠ ã§ãã¾ã™
        ];
        
        // ç”»åƒãŒå‡ºã‚‹ç¢ºç‡ï¼ˆ0.3 = 30%, 1.0 = 100%ï¼‰
        const imageProbability = 0.75; 
        // ==========================================

        let availableNumbers = [];
        let historyStack = [];
        let minNum = 1, maxNum = 50;
        let totalCount = 0;
        let isAnimating = false;

        function initApp() {
            minNum = parseInt(document.getElementById('min-num').value);
            maxNum = parseInt(document.getElementById('max-num').value);
            if (!minNum || !maxNum || minNum > maxNum) { alert("ç¯„å›²ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

            availableNumbers = [];
            for (let i = minNum; i <= maxNum; i++) availableNumbers.push(i);
            totalCount = availableNumbers.length;
            historyStack = [];

            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('ticket-range').innerText = `${minNum} - ${maxNum}`;
            
            document.getElementById('display').innerText = "Ready";
            updateStatus();
        }

        // ãã˜å¼•ãæ¼”å‡ºã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
        function startDrawSequence() {
            if (isAnimating) return;
            if (availableNumbers.length === 0) { alert("çµ‚äº†ã§ã™ï¼"); return; }

            isAnimating = true;
            const btn = document.getElementById('draw-btn');
            btn.disabled = true;

            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('photo-instruction').classList.add('hidden');
            document.getElementById('special-img').classList.remove('show');
            document.getElementById('display').classList.remove('pop-in');

            const box = document.getElementById('gift-box');
            box.classList.remove('hidden');
            box.classList.add('shaking');

            // ğŸ‘‡ æ™‚é–“å¤‰æ›´ç®‡æ‰€ï¼š1000ãƒŸãƒªç§’ï¼ˆ1ç§’ï¼‰ã«å¤‰æ›´
            setTimeout(() => {
                box.classList.remove('shaking');
                box.classList.add('hidden');
                drawNumberLogic();
                isAnimating = false;
                if (availableNumbers.length > 0) btn.disabled = false;
            }, 1000); 
        }

        function drawNumberLogic() {
            const randomIndex = Math.floor(Math.random() * availableNumbers.length);
            const selectedNumber = availableNumbers[randomIndex];

            availableNumbers.splice(randomIndex, 1);
            historyStack.push({ number: selectedNumber, hasImage: false });

            const displayEl = document.getElementById('display');
            displayEl.innerText = selectedNumber;
            
            const imgEl = document.getElementById('special-img');
            const shouldShowImage = (Math.random() < imageProbability) && (funnyImages.length > 0);
            
            if (shouldShowImage) {
                const randomImgIndex = Math.floor(Math.random() * funnyImages.length);
                imgEl.src = funnyImages[randomImgIndex];
                imgEl.classList.add('show');
                historyStack[historyStack.length - 1].hasImage = true;
                historyStack[historyStack.length - 1].imgSrc = funnyImages[randomImgIndex];
            } else {
                imgEl.classList.remove('show');
            }

            document.getElementById('result-area').classList.remove('hidden');
            displayEl.classList.add('pop-in');
            
            updateStatus();
            document.getElementById('undo-btn').disabled = false;
            document.getElementById('photo-instruction').classList.remove('hidden');

            if (availableNumbers.length === 0) {
                document.getElementById('draw-btn').innerText = "å®Œå£²";
                document.getElementById('draw-btn').disabled = true;
            }
        }

        function undo() {
            if (historyStack.length === 0) return;
            const lastEntry = historyStack[historyStack.length - 1];
            const lastNum = lastEntry.number;

            if (!confirm(`ã€ ${lastNum}ç•ª ã€‘ã‚’ç®±ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ`)) return;

            historyStack.pop();
            availableNumbers.push(lastNum);
            availableNumbers.sort((a, b) => a - b);

            document.getElementById('display').innerText = "Ready";
            document.getElementById('special-img').classList.remove('show');
            document.getElementById('photo-instruction').classList.add('hidden');
            document.getElementById('undo-btn').disabled = true;

            updateStatus();
            document.getElementById('draw-btn').disabled = false;
            document.getElementById('draw-btn').innerText = "ãã˜ã‚’å¼•ã";
        }

        function updateStatus() {
            document.getElementById('count-info').innerText = `æ®‹ã‚Š: ${availableNumbers.length} / ${totalCount}`;
        }

        function openStatusModal() {
            const grid = document.getElementById('status-grid');
            grid.innerHTML = "";
            for (let i = minNum; i <= maxNum; i++) {
                const div = document.createElement('div');
                div.classList.add('grid-item');
                div.innerText = i;
                if (!availableNumbers.includes(i)) div.classList.add('drawn');
                grid.appendChild(div);
            }
            document.getElementById('status-modal').classList.remove('hidden');
        }

        function closeStatusModal(e) {
            if (e.target.id === 'status-modal') e.target.classList.add('hidden');
        }

        function resetApp() {
            if (confirm("è¨­å®šã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿå±¥æ­´ã¯æ¶ˆãˆã¾ã™ã€‚")) location.reload();
        }
    </script>
</body>
</html>